<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Harvey's Decision Engine | SWIPE-OS v6.0 (Unified)</title>
    <style>
        /* =========================================
           CORE SYSTEM
           ========================================= */
        :root {
            --brand-orange: #ff671f;
            --brand-bg: #0a0a0a;
            --text-main: #f0f0f0;
            --accent-go: #00e676; 
            --font-tech: 'Courier New', monospace;
            --font-ui: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        html, body {
            margin: 0; padding: 0; height: 100%; width: 100%;
            background-color: var(--brand-bg);
            color: var(--text-main);
            font-family: var(--font-ui);
            overflow: hidden;
            touch-action: none; /* HARD LOCK */
        }

        #master-container {
            height: 100vh;
            width: 100vw;
            position: relative;
            overflow: hidden;
        }

        .main-slide {
            height: 100vh;
            width: 100vw;
            position: absolute;
            top: 0;
            left: 0;
            display: flex;
            flex-direction: column;
            background: var(--brand-bg);
            transition: transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
            will-change: transform;
        }

        .main-slide.prev { transform: translateY(-100%); }
        .main-slide.active { transform: translateY(0); z-index: 10; }
        .main-slide.next { transform: translateY(100%); z-index: 20; }

        .slide-header {
            padding: 20px;
            border-left: 3px solid var(--brand-orange);
            height: 70px;
            flex-shrink: 0;
            z-index: 50;
            display: flex;
            align-items: center;
            transition: opacity 0.3s;
        }
        
        /* MODE STATES */
        .main-slide.deck-active .slide-header { opacity: 0.3; }
        .main-slide.deck-active { background: #050505; }

        .header-title {
            font-family: var(--font-tech);
            font-size: 0.75rem;
            color: var(--brand-orange);
            letter-spacing: 1px;
            font-weight: 700;
            text-transform: uppercase;
        }

        /* =========================================
           CONTENT DECK (PHYSICS ENABLED)
           ========================================= */
        .carousel-viewport {
            position: relative;
            flex-grow: 1;
            width: 100%;
            height: 100%;
            perspective: 1000px;
        }

        .sub-slide {
            position: absolute;
            inset: 0;
            padding: 25px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background: var(--brand-bg);
            /* Physics Base */
            transition: transform 0.1s linear, opacity 0.1s linear; 
            will-change: transform, opacity;
            border-left: 1px dashed #333;
        }

        /* LOGIC MODE STACKING (Alchemist) */
        .sub-slide.layer-1 { z-index: 30; opacity: 1; transform: translateY(0); } /* Visual */
        .sub-slide.layer-2 { z-index: 20; opacity: 0; transform: translateY(30px) scale(0.95); } /* Logic */
        .sub-slide.layer-3 { z-index: 10; opacity: 0; transform: translateY(60px) scale(0.90); } /* Proof */

        /* OPTIONS MODE STACKING (Horizontal) */
        .sub-slide.opt-active { z-index: 30; opacity: 1; transform: translateX(0); transition: transform 0.3s ease; }
        .sub-slide.opt-hidden { z-index: 0; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }

        /* Typography */
        h1 { font-size: 1.8rem; margin: 0 0 15px 0; line-height: 1; letter-spacing: -1px; color: var(--brand-orange); pointer-events: none; }
        .primary-question { font-size: 1.1rem; color: #fff; margin-bottom: 25px; line-height: 1.4; font-weight: 600; pointer-events: none; }
        .content-text { font-size: 0.9rem; color: #aaa; line-height: 1.6; pointer-events: none; }

        .item-list { list-style: none; padding: 0; margin-top: 10px; }
        .item-list li { padding: 6px 0; border-bottom: 1px solid #222; font-size: 0.85rem; color: #ccc; }
        
        .role-label {
            font-family: var(--font-tech);
            font-size: 0.6rem;
            color: #000;
            background: var(--accent-go);
            padding: 4px 8px;
            border-radius: 4px;
            width: fit-content;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .ascii-box {
            background: #080808;
            border: 1px solid #333;
            color: var(--accent-go);
            font-family: var(--font-tech);
            font-size: 0.75rem;
            padding: 15px;
            border-radius: 6px;
            white-space: pre;
            line-height: 1.2;
            margin-top: 20px;
        }

        /* =========================================
           UI: VERDICT & TICKET
           ========================================= */
        .verdict-container { display: flex; flex-direction: column; height: 100%; justify-content: center; }
        .input-group { border: 1px solid #333; background: #111; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .input-row { display: flex; justify-content: space-between; border-bottom: 1px dashed #333; padding: 10px 0; font-family: var(--font-tech); font-size: 0.8rem; }
        .input-key { color: #888; text-transform: uppercase; }
        .input-val { color: var(--accent-go); font-weight: bold; }
        
        .final-actions { display: grid; gap: 10px; margin-top: auto; }
        .btn { background: #222; color: #fff; border: 1px solid #333; padding: 16px; border-radius: 8px; font-weight: 600; text-align: center; }
        .btn-wa { background: #25D366; color: #000; border: none; }
        .btn-share { background: var(--brand-orange); border: none; }

        /* =========================================
           LISTEN & MODE UI
           ========================================= */
        #mic-toggle {
            position: fixed; bottom: 30px; left: 30px; width: 60px; height: 60px;
            background: #111; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            border: 1px solid #444; z-index: 2000; cursor: pointer; transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        #mic-toggle svg { width: 28px; height: 28px; fill: #666; }
        #mic-toggle.listening { border-color: var(--accent-go); background: rgba(0, 230, 118, 0.1); animation: pulse 1.5s infinite; }
        #mic-toggle.listening svg { fill: var(--accent-go); }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(0,230,118,0.4); } 70% { box-shadow: 0 0 0 15px rgba(0,230,118,0); } }

        #mode-indicator {
            position: fixed; bottom: 30px; left: 0; width: 100%; text-align: center;
            font-family: var(--font-tech); font-size: 0.7rem; color: #666; pointer-events: none;
            text-transform: uppercase; letter-spacing: 1px; opacity: 0; transition: opacity 0.3s;
        }
        #mode-indicator.visible { opacity: 1; }

        .toast-msg {
            position: fixed; bottom: 110px; left: 50%; transform: translateX(-50%);
            background: #222; color: #00e676; padding: 10px 20px; border: 1px solid #00e676;
            border-radius: 20px; font-size: 0.8rem; opacity: 0; pointer-events: none;
            transition: opacity 0.3s; z-index: 2000; font-family: var(--font-tech);
        }
        .toast-msg.visible { opacity: 1; }

    </style>
</head>
<body>

<div id="master-container"></div>
<div id="mode-indicator"></div>
<div id="toast" class="toast-msg"></div>

<div id="mic-toggle" onclick="toggleListenMode()">
    <svg viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
</div>

<script>
    /* =========================================
       1. GLOBAL STATE & CONFIG
       ========================================= */
    const CONFIG = {
      "slides": [
        // 1. BURGERS (OPTIONS)
        {
          "id": "burger", "type": "selector", "title": "01 / 13 · BURGERS", "key": "burger",
          "options": {
            "ORIGINAL": { "items": ["Original Burger"], "tag": "NOSTALGIA", "voice": ["original", "classic"] },
            "ANGUS": { "items": ["Angus Burger"], "tag": "QUALITY", "voice": ["angus", "premium"] },
            "VEGGIE": { "items": ["Veggie Burger"], "tag": "PLANT", "voice": ["veggie"] }
          }
        },
        // 2. CHICKEN (OPTIONS)
        {
          "id": "chicken", "type": "selector", "title": "02 / 13 · CHICKEN", "key": "chicken",
          "options": {
            "CRISPY": { "items": ["Crispy Sandwich"], "tag": "TEXTURE", "voice": ["crispy"] },
            "GRILLED": { "items": ["Grilled Sandwich"], "tag": "HEALTH", "voice": ["grilled"] },
            "BUFFALO": { "items": ["Buffalo Sandwich"], "tag": "SPICY", "voice": ["buffalo"] }
          }
        },
        // 3. SIDES (OPTIONS)
        {
          "id": "sides", "type": "selector", "title": "03 / 13 · SIDES", "key": "side",
          "options": {
            "POUTINE": { "items": ["Classic Poutine"], "tag": "COMFORT", "voice": ["poutine"] },
            "SIDES": { "items": ["Frings", "Fries"], "tag": "CLASSIC", "voice": ["sides", "fries", "rings"] }
          }
        },
        // 4. VALUE (OPTIONS)
        {
          "id": "value", "type": "selector", "title": "04 / 13 · VALUE", "key": "value",
          "options": {
            "JR_BURGERS": { "items": ["Jr. Burger"], "tag": "BUDGET", "voice": ["junior"] },
            "SNACKS": { "items": ["Nuggets"], "tag": "QUICK", "voice": ["nuggets"] },
            "DESSERTS": { "items": ["Donuts"], "tag": "SWEET", "voice": ["donut"] }
          }
        },
        // 5. DRINKS (OPTIONS)
        {
          "id": "drinks", "type": "selector", "title": "05 / 13 · DRINKS", "key": "drink",
          "options": {
            "SHAKES": { "items": ["Chocolate Shake"], "tag": "DESSERT", "voice": ["shake"] },
            "STANDARD": { "items": ["Pepsi"], "tag": "BASIC", "voice": ["pop", "soda"] }
          }
        },
        // 6. TICKET
        { "id": "final", "type": "final", "title": "06 / 13 · ORDER TICKET" },
        // 7-12. LOGIC SLIDES
        { "id": "hunger", "type": "standard", "title": "07 / 13 · HUNGER", "visual": { "h1": "HOW HUNGRY?", "q": "Calibrating protein.", "txt": "High hunger favors Angus." }, "logic": { "txt": "Angus is 100% beef. Original is formed patty." }, "proof": { "ascii": "[ SATIETY ]\nOriginal: [==  ]\nAngus:    [====]" } },
        { "id": "timing", "type": "selector", "title": "08 / 13 · TIMING", "key": "timing", "options": { "OFF-PEAK": { "items": ["After 2PM"], "tag": "SMART", "voice": ["off peak"] }, "PEAK": { "items": ["Lunch Rush"], "tag": "RISKY", "voice": ["peak"] } } },
        { "id": "consistency", "type": "standard", "title": "09 / 13 · CONSISTENCY", "visual": { "h1": "EXECUTION RISK", "q": "Tolerate variance?", "txt": "Depends on staff." }, "logic": { "txt": "Human scooping has variance." }, "proof": { "ascii": "[ VARIANCE ]\nTarget: 15g\nActual: 10-25g" } },
        { "id": "patty", "type": "standard", "title": "10 / 13 · PATTY LOGIC", "visual": { "h1": "TEXTURE", "q": "Mouthfeel?", "txt": "Original is softer." }, "logic": { "txt": "Angus holds toppings better." }, "proof": { "ascii": "[ DENSITY ]" } },
        { "id": "method", "type": "standard", "title": "11 / 13 · THE RITUAL", "visual": { "h1": "GARNISH CONTROL", "q": "Why Harvey’s?", "txt": "Live assembly." }, "logic": { "txt": "Transparency forces quality." }, "proof": { "ascii": "[ VISIBILITY ]" } },
        { "id": "valuestack", "type": "standard", "title": "12 / 13 · STACKING", "visual": { "h1": "MINIMIZE SPEND", "q": "Don't pay full price.", "txt": "Use Coupons." }, "logic": { "txt": "Coupon > CAA > Points." }, "proof": { "ascii": "[ SAVINGS ]" } },
        // 13. BRAND
        { "id": "brand", "type": "brand", "title": "13 / 13 · NATIONAL ICON" }
      ]
    };

    let GESTURE_MODE = "MAIN"; // MAIN | OPTIONS | LOGIC
    let USER_CART = {}; // Zero-state
    
    let slideElements = [];
    let currentIdx = 0;
    
    // Physics State
    let dragRatio = 0;
    let depthLevel = 0;
    const MAX_DRAG = 250;

    /* =========================================
       2. INITIALIZATION & BUILDER
       ========================================= */
    const container = document.getElementById('master-container');

    function init() {
        console.log("SWIPE-OS v6.0 BOOT");
        
        CONFIG.slides.forEach((cfg, idx) => {
            const section = document.createElement('section');
            section.className = `main-slide ${idx === 0 ? 'active' : 'next'}`;
            section.id = cfg.id;
            // Determine Mode Type for slide
            section.dataset.mode = (cfg.type === 'selector') ? 'options' : 
                                   (cfg.type === 'standard') ? 'logic' : 'static';

            let innerHTML = `<div class="slide-header"><span class="header-title">${cfg.title}</span></div>`;
            innerHTML += `<div class="carousel-viewport" data-key="${cfg.key || ''}">`;

            if (cfg.type === 'selector') {
                const keys = Object.keys(cfg.options);
                keys.forEach((k, i) => {
                    const opt = cfg.options[k];
                    innerHTML += `
                        <div class="sub-slide ${i===0 ? 'opt-active' : 'opt-hidden'}" data-opt-idx="${i}" data-val="${k}">
                            <div class="role-label">${opt.tag}</div>
                            <h1>${k}</h1>
                            <div class="primary-question">${opt.items[0]}</div>
                            <div class="content-text"><ul class="item-list"><li>Swipe LEFT/RIGHT to compare</li><li>Pull DOWN to Select</li></ul></div>
                        </div>`;
                });
            } else if (cfg.type === 'standard') {
                // Stacked Layers for Alchemist Physics
                innerHTML += `
                    <div class="sub-slide layer-1">
                        <h1>${cfg.visual.h1}</h1>
                        <div class="primary-question">${cfg.visual.q}</div>
                        <div class="content-text">${cfg.visual.txt}</div>
                        <small style="color:#666; margin-top:20px; font-size:0.7rem;">&darr; Pull Down to Inspect Logic</small>
                    </div>
                    <div class="sub-slide layer-2">
                        <div class="role-label">LOGIC LAYER</div>
                        <div class="content-text">${cfg.logic.txt}</div>
                    </div>
                    <div class="sub-slide layer-3">
                        <div class="role-label">PROOF LAYER</div>
                        <div class="ascii-box">${cfg.proof.ascii}</div>
                    </div>
                `;
            } else if (cfg.type === 'final') {
                innerHTML += `
                    <div class="sub-slide layer-1">
                        <div class="verdict-container">
                            <div class="choice-header">YOUR ORDER</div>
                            <div class="input-group" id="ticket-content"></div>
                            <div class="final-actions">
                                <button class="btn btn-wa" onclick="sendTicket()">SAVE TICKET</button>
                                <button class="btn btn-support" onclick="sendSupport()">SUPPORT</button>
                            </div>
                        </div>
                    </div>`;
            } else if (cfg.type === 'brand') {
                innerHTML += `
                    <div class="sub-slide layer-1">
                        <div class="verdict-container" style="text-align:center;">
                            <div class="brand-logo-placeholder" style="width:80px;height:80px;border-radius:50%;border:2px solid #ff671f;margin:0 auto 20px;display:flex;align-items:center;justify-content:center;color:#ff671f;font-weight:900;">H</div>
                            <h1>100% CANADIAN</h1>
                            <div class="content-text">Founded 1959. No hidden kitchens.</div>
                            <div class="final-actions" style="margin-top:40px;">
                                <button class="btn btn-share" onclick="copyLink()">SHARE APP</button>
                                <button class="btn btn-insta" onclick="followInsta()">INSTAGRAM</button>
                                <button class="btn" onclick="location.reload()">START OVER</button>
                            </div>
                        </div>
                    </div>`;
            }

            innerHTML += `</div>`; // End viewport
            section.innerHTML = innerHTML;
            container.appendChild(section);
        });

        slideElements = Array.from(document.querySelectorAll('.main-slide'));
        updateTicket(); // Init ticket
        attachEvents(); // Bind physics
    }

    /* =========================================
       3. NAVIGATION & PHYSICS CONTROLLER
       ========================================= */
    function goToSlide(idx) {
        if (idx < 0 || idx >= slideElements.length) return;
        
        // Reset Current
        const curr = slideElements[currentIdx];
        curr.classList.remove('active', 'deck-active');
        
        // 2. FORCE MAIN MODE
        GESTURE_MODE = "MAIN"; 
        updateModeIndicator();
        resetPhysics(curr);

        // Move
        if (idx > currentIdx) { curr.classList.add('prev'); curr.classList.remove('next'); }
        else { curr.classList.add('next'); curr.classList.remove('prev'); }

        currentIdx = idx;
        const next = slideElements[currentIdx];
        next.classList.remove('prev', 'next');
        next.classList.add('active');

        if(next.id === 'final') updateTicket();
    }

    function resetPhysics(slide) {
        dragRatio = 0;
        depthLevel = 0;
        const deck = slide.querySelector('.carousel-viewport');
        const layers = deck.querySelectorAll('.sub-slide');
        
        // Reset Logic Layers
        if (slide.dataset.mode === 'logic') {
            layers.forEach((l, i) => {
                l.style.transform = i===0 ? 'translateY(0)' : `translateY(${i*30}px) scale(0.9)`;
                l.style.opacity = i===0 ? 1 : 0;
            });
        }
    }

    /* =========================================
       4. PHYSICS ENGINE (ALCHEMIST & SWIPE)
       ========================================= */
    function updatePhysicsVisuals(view, ratio) {
        const layers = view.querySelectorAll('.sub-slide');
        if (layers.length < 3) return; // Only for logic slides

        const l1 = layers[0]; // Visual
        const l2 = layers[1]; // Logic
        const l3 = layers[2]; // Proof

        // Alchemist Ratio Logic
        // 0.0 - 0.3: Visual moves up slightly, fades
        // 0.3 - 0.6: Logic enters
        // 0.6 - 1.0: Proof enters

        if (ratio > 0) {
            l1.style.transform = `translateY(${ratio * -60}px) scale(${1 - ratio*0.1})`;
            l1.style.opacity = 1 - (ratio * 0.5);
        } else {
            l1.style.transform = 'translateY(0)'; l1.style.opacity = 1;
        }

        if (ratio > 0.2) {
            let l2Op = Math.min(1, (ratio - 0.2) * 3);
            l2.style.opacity = l2Op;
            l2.style.transform = `translateY(${60 - (ratio * 60)}px) scale(1)`;
        } else {
            l2.style.opacity = 0;
        }

        if (ratio > 0.6) {
            let l3Op = Math.min(1, (ratio - 0.6) * 4);
            l3.style.opacity = l3Op;
            l3.style.transform = `translateY(${80 - (ratio * 80)}px)`;
        } else {
            l3.style.opacity = 0;
        }
    }

    function attachEvents() {
        let startX = 0, startY = 0;

        document.querySelectorAll('.carousel-viewport').forEach(view => {
            const slide = view.closest('.main-slide');
            const mode = slide.dataset.mode; // 'options' or 'logic' or 'static'
            const slides = Array.from(view.querySelectorAll('.sub-slide'));
            
            // State for options
            view._currOpt = 0;

            view.addEventListener('touchstart', e => {
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
            }, {passive: true});

            view.addEventListener('touchmove', e => {
                const dx = e.touches[0].clientX - startX;
                const dy = e.touches[0].clientY - startY;
                const axis = Math.abs(dx) > Math.abs(dy) ? 'x' : 'y';

                // --- LOGIC MODE (VERTICAL DRAG) ---
                if (GESTURE_MODE === 'LOGIC' && axis === 'y' && dy > 0 && mode === 'logic') {
                    e.preventDefault();
                    dragRatio = Math.min(dy / MAX_DRAG, 1);
                    updatePhysicsVisuals(view, dragRatio);
                }

                // --- OPTIONS MODE (HORIZONTAL SWIPE VISUAL) ---
                if (GESTURE_MODE === 'OPTIONS' && axis === 'x' && mode === 'options') {
                    // Simple visual feedback could go here
                }

            }, {passive: false});

            view.addEventListener('touchend', e => {
                const dx = e.changedTouches[0].clientX - startX;
                const dy = e.changedTouches[0].clientY - startY;
                const axis = Math.abs(dx) > Math.abs(dy) ? 'x' : 'y';

                // 1. MAIN NAVIGATION (Only if in MAIN mode)
                if (GESTURE_MODE === 'MAIN') {
                    if (axis === 'y' && dy < -50) goToSlide(currentIdx + 1); // Swipe Up -> Next
                    if (axis === 'y' && dy > 50 && mode !== 'static') {
                        // Enter Depth Mode
                        GESTURE_MODE = mode === 'options' ? 'OPTIONS' : 'LOGIC';
                        slide.classList.add('deck-active');
                        updateModeIndicator();
                    }
                    return;
                }

                // 2. EXIT DEPTH (Swipe Up)
                if ((GESTURE_MODE === 'LOGIC' || GESTURE_MODE === 'OPTIONS') && axis === 'y' && dy < -50) {
                    GESTURE_MODE = 'MAIN';
                    slide.classList.remove('deck-active');
                    updateModeIndicator();
                    resetPhysics(slide);
                    return;
                }

                // 3. LOGIC INTERACTION (Snap)
                if (GESTURE_MODE === 'LOGIC') {
                    if (dragRatio > 0.8) {
                        // Snap to full depth
                        updatePhysicsVisuals(view, 1.0);
                    } else {
                        // Snap back closed
                        updatePhysicsVisuals(view, 0);
                    }
                    dragRatio = 0;
                }

                // 4. OPTIONS INTERACTION (Swipe L/R)
                if (GESTURE_MODE === 'OPTIONS' && axis === 'x' && Math.abs(dx) > 50) {
                    const total = slides.length;
                    let curr = view._currOpt;

                    if (dx < 0 && curr < total-1) curr++;
                    if (dx > 0 && curr > 0) curr--;

                    view._currOpt = curr;
                    
                    // Update Visibility
                    slides.forEach((s, i) => {
                        if (i === curr) {
                            s.classList.remove('opt-hidden');
                            s.classList.add('opt-active');
                        } else {
                            s.classList.remove('opt-active');
                            s.classList.add('opt-hidden');
                        }
                    });
                }

                // 5. SELECT OPTION (Pull Down in Options)
                if (GESTURE_MODE === 'OPTIONS' && axis === 'y' && dy > 50) {
                    const selected = slides[view._currOpt];
                    const key = view.dataset.key;
                    const val = selected.dataset.val;
                    
                    USER_CART[key] = val;
                    showToast(`SELECTED: ${val}`);
                    
                    // Auto-exit options after select? No, let user explore.
                    // But maybe bounce effect?
                }

            });
        });
    }

    /* =========================================
       5. LOGIC & HELPERS
       ========================================= */
    function updateTicket() {
        const t = document.getElementById('ticket-content');
        if (!t) return;
        
        let html = '';
        const keys = Object.keys(USER_CART);
        
        if (keys.length === 0) {
            html = '<div style="text-align:center;color:#666;">No items selected.<br>Swipe or speak to build order.</div>';
        } else {
            keys.forEach(k => {
                html += `
                <div class="input-row">
                    <span class="input-key">${k.toUpperCase()}</span>
                    <span class="input-val">${USER_CART[k]}</span>
                </div>`;
            });
        }
        t.innerHTML = html;
    }

    function showToast(msg) {
        const t = document.getElementById('toast');
        t.innerText = msg;
        t.classList.add('visible');
        setTimeout(() => t.classList.remove('visible'), 2000);
    }

    function updateModeIndicator() {
        const m = document.getElementById('mode-indicator');
        if (GESTURE_MODE === 'MAIN') m.classList.remove('visible');
        else {
            m.innerText = GESTURE_MODE === 'LOGIC' ? 'LOGIC MODE (Vertical)' : 'OPTIONS MODE (Horizontal)';
            m.classList.add('visible');
        }
    }

    // ACTIONS
    function sendWhatsappTicket() {
        let msg = "MY HARVEY'S ORDER:\n";
        Object.keys(USER_CART).forEach(k => msg += `- ${k.toUpperCase()}: ${USER_CART[k]}\n`);
        window.open(`https://wa.me/916351537770?text=${encodeURIComponent(msg)}`, '_blank');
    }
    function sendSupport() {
        window.open(`https://wa.me/916351537770?text=${encodeURIComponent("I needed assistance with my order flow. Thanks!. How can I Support")}`, '_blank');
    }
    function copyLink() {
        navigator.clipboard.writeText("https://dharamdaxini.github.io/via.decide.food/");
        showToast("LINK COPIED");
    }
    function followInsta() {
        window.open("https://www.instagram.com/harveys?igsh=MWY0M3VyemQ2NHFjZw==", '_blank');
    }

    /* =========================================
       6. LISTEN MODE (VOICE)
       ========================================= */
    let recognition;
    let isListening = false;

    function toggleListenMode() {
        if (!('webkitSpeechRecognition' in window)) return alert("Browser not supported");
        
        const btn = document.getElementById('mic-toggle');
        
        if (isListening) {
            recognition.stop();
            isListening = false;
            btn.classList.remove('listening');
        } else {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.lang = 'en-US';
            
            recognition.onstart = () => { isListening = true; btn.classList.add('listening'); };
            recognition.onend = () => { isListening = false; btn.classList.remove('listening'); };
            
            recognition.onresult = (e) => {
                const txt = e.results[0][0].transcript.toLowerCase();
                processVoice(txt);
            };
            recognition.start();
        }
    }

    function processVoice(cmd) {
        showToast(`Heard: "${cmd}"`);
        
        // Navigation
        if (cmd.includes("next")) return goToSlide(currentIdx + 1);
        if (cmd.includes("back")) return goToSlide(currentIdx - 1);
        
        // Actions
        if (cmd.includes("ticket") || cmd.includes("save")) return sendWhatsappTicket();
        
        // Selection Matching
        // Very basic fuzzy match against config
        CONFIG.slides.forEach(s => {
            if (s.type === 'selector') {
                Object.keys(s.options).forEach(optKey => {
                    const opt = s.options[optKey];
                    if (opt.voice && opt.voice.some(v => cmd.includes(v))) {
                        USER_CART[s.key] = optKey;
                        showToast(`Added ${optKey}`);
                        if(slideElements[currentIdx].id === 'final') updateTicket();
                    }
                });
            }
        });
    }

    init();

</script>
</body>
</html>
