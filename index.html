<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Harvey's Decision Engine | SWIPE-OS v6.3 (Punjabi Flow)</title>
    <style>
        /* =========================================
           CORE SYSTEM
           ========================================= */
        :root {
            --brand-orange: #ff671f;
            --brand-bg: #0a0a0a;
            --text-main: #f0f0f0;
            --accent-go: #00e676; 
            --font-tech: 'Courier New', monospace;
            --font-ui: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        html, body {
            margin: 0; padding: 0; height: 100%; width: 100%;
            background-color: var(--brand-bg);
            color: var(--text-main);
            font-family: var(--font-ui);
            overflow: hidden;
        }

        #master-container {
            height: 100vh;
            width: 100vw;
            position: relative;
            overflow: hidden;
        }

        .main-slide {
            height: 100vh;
            width: 100vw;
            position: absolute;
            top: 0;
            left: 0;
            display: flex;
            flex-direction: column;
            background: var(--brand-bg);
            transition: transform 0.6s cubic-bezier(0.19, 1, 0.22, 1);
            will-change: transform;
        }

        .main-slide.prev { transform: translateY(-100%); }
        .main-slide.active { transform: translateY(0); z-index: 10; }
        .main-slide.next { transform: translateY(100%); z-index: 20; }

        .slide-header {
            padding: 20px;
            border-left: 3px solid var(--brand-orange);
            height: 70px;
            flex-shrink: 0;
            z-index: 10;
            display: flex;
            align-items: center;
            transition: opacity 0.3s;
        }
        
        .main-slide.deck-active .slide-header { opacity: 0.2; }
        .main-slide.deck-active { background: #000; }

        .header-title {
            font-family: var(--font-tech);
            font-size: 0.75rem;
            color: var(--brand-orange);
            letter-spacing: 1px;
            font-weight: 700;
            text-transform: uppercase;
        }

        /* =========================================
           CONTENT DECK
           ========================================= */
        .carousel-viewport {
            position: relative;
            flex-grow: 1;
            width: 100%;
            touch-action: none;
        }

        .sub-slide {
            position: absolute;
            inset: 0;
            padding: 25px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transform: translateY(0) scale(1);
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.3s ease;
        }

        .sub-slide.opt-active { z-index: 30; opacity: 1; pointer-events: auto; transform: translateX(0); }
        .sub-slide.opt-hidden { z-index: 0; opacity: 0; pointer-events: none; }
        .sub-slide.static { z-index: 30; opacity: 1; pointer-events: auto; }

        h1 { font-size: 1.8rem; margin: 0 0 15px 0; line-height: 1; letter-spacing: -1px; color: var(--brand-orange); }
        .primary-question { font-size: 1.1rem; color: #fff; margin-bottom: 25px; line-height: 1.4; font-weight: 600; }
        .content-text { font-size: 0.9rem; color: #aaa; line-height: 1.6; }

        .role-label {
            font-family: var(--font-tech);
            font-size: 0.6rem;
            color: #000;
            background: var(--accent-go);
            padding: 4px 8px;
            border-radius: 4px;
            width: fit-content;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .nav-hint {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #333;
            font-family: var(--font-tech);
            font-size: 0.7rem;
            color: #666;
            display: flex;
            justify-content: space-between;
        }

        /* =========================================
           ACTIONS & FINAL
           ========================================= */
        .final-actions {
            display: grid;
            gap: 12px;
            margin-top: 40px;
        }
        .btn {
            background: #222;
            color: #fff;
            border: 1px solid #333;
            padding: 18px;
            width: 100%;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .btn:active { transform: scale(0.98); }
        .btn-wa { background: #25D366; color: #000; border: none; }
        
        .status-box {
            background: #111;
            border: 1px solid #333;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-top: 20px;
        }
        .status-val { color: var(--accent-go); font-size: 1.5rem; font-weight: bold; display: block; margin-bottom: 5px; }

        #depth-fill {
            position: fixed; right: 0; top: 0; bottom: 0; width: 4px;
            background: #333; z-index: 900;
            height: 0%; transition: height 0.05s linear, background 0.3s;
        }

        /* Toast for feedback */
        .toast-msg {
            position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%);
            background: #222; color: #00e676; padding: 12px 24px;
            border: 1px solid #00e676;
            border-radius: 30px; font-size: 0.8rem; opacity: 0; pointer-events: none;
            transition: opacity 0.3s; z-index: 2500; font-family: var(--font-tech);
            white-space: nowrap;
        }
        .toast-msg.visible { opacity: 1; }

    </style>
</head>
<body>

<div id="master-container"></div>
<div id="depth-fill"></div>
<div id="toast" class="toast-msg">ACTION CONFIRMED</div>

<script>
    /* =========================================
       CONFIG: PUNJABI FOOD FLOW
       ========================================= */
    const CONFIG = {
      "ui_pack": {
        "region": "PUNJABI",
        "language": "EN_SIMPLE",
        "tone": "decisive_calm",
        "font_bias": "large_titles"
      },
      "slides": [
        {
          "id": "slide_01_item",
          "type": "selector",
          "title": "WHAT ARE YOU CRAVING?",
          "hint": "Swipe left / right",
          "options": [
            { "id": "butter_chicken", "label": "Butter Chicken", "sub": "Creamy • Rich • Punjabi Classic", "tags": ["non_veg", "comfort"] },
            { "id": "paneer_butter_masala", "label": "Paneer Butter Masala", "sub": "Creamy • Veg • Safe Choice", "tags": ["veg", "comfort"] },
            { "id": "chole_bhature", "label": "Chole Bhature", "sub": "Heavy • Spicy • Street Style", "tags": ["veg", "filling"] }
          ],
          "commit_action": "add_to_cart.main"
        },
        {
          "id": "slide_02_style",
          "type": "decision",
          "title": "WHAT KIND OF MEAL IS THIS?",
          "hint": "Swipe left / right",
          "options": [
            { "id": "comfort", "label": "Comfort Food", "sub": "Creamy • Familiar • No experiments" },
            { "id": "protein", "label": "Protein Focus", "sub": "Filling • Heavy • Long-lasting" }
          ],
          "affects": ["restaurant_match", "menu_filter"]
        },
        {
          "id": "slide_03_people",
          "type": "decision",
          "title": "WHO ARE YOU EATING WITH?",
          "hint": "Swipe left / right",
          "options": [
            { "id": "solo", "label": "Just Me", "sub": "Fast • Minimal • Direct" },
            { "id": "group", "label": "Family / Friends", "sub": "More items • Sharing" }
          ],
          "affects": ["portion_size", "cart_expansion"]
        },
        {
          "id": "slide_04_wait",
          "type": "decision",
          "title": "HOW MUCH WAIT IS OK?",
          "hint": "Swipe left / right",
          "options": [
            { "id": "quick", "label": "ASAP", "sub": "Under 30 minutes" },
            { "id": "relaxed", "label": "I Can Wait", "sub": "Quality > Speed" }
          ],
          "affects": ["online_vs_direct"]
        },
        {
          "id": "slide_05_llm",
          "type": "llm_summary",
          "title": "BEST WAY TO ORDER",
          "cards": [
            { "id": "recommendation_a", "label": "BEST ONLINE OPTION", "sub": "Based on availability & speed", "placeholder": true },
            { "id": "recommendation_b", "label": "BEST LOCAL OPTION", "sub": "Direct from restaurant", "placeholder": true }
          ]
        },
        {
          "id": "slide_06_availability",
          "type": "status",
          "title": "LIVE OPTIONS RIGHT NOW",
          "display": "4 of 4 services live",
          "services": ["zomato", "swiggy", "blinkit", "local"]
        },
        {
          "id": "slide_07_final",
          "type": "final",
          "title": "WHAT DO YOU WANT TO DO?",
          "actions": [
            { "id": "order_online", "label": "Order via App", "sub": "Zomato / Swiggy / Blinkit", "action": "online" },
            { "id": "order_direct", "label": "Order from Restaurant", "sub": "WhatsApp / Call", "action": "whatsapp" },
            { "id": "custom_build", "label": "Build This For My Business", "sub": "Restaurants • Cafes • Brands", "action": "b2b" }
          ]
        }
      ]
    };

    /* =========================================
       STATE & BUILDER
       ========================================= */
    let USER_DATA = {}; 
    const container = document.getElementById('master-container');
    let slideElements = [];
    let currentIdx = 0;
    let dragRatio = 0;
    const MAX_DRAG = 300; 
    const TRIGGER_THRESHOLD = 0.9;

    function init() {
        console.log("BOOTING SWIPE-OS v6.3...");
        
        CONFIG.slides.forEach((cfg, idx) => {
            const section = document.createElement('section');
            section.className = `main-slide ${idx === 0 ? 'active' : 'next'}`;
            section.id = cfg.id;
            
            // Mode determination
            let mode = 'static';
            if(cfg.type === 'selector' || cfg.type === 'decision') mode = 'options';
            section.dataset.mode = mode;

            let innerHTML = `<div class="slide-header"><span class="header-title">${cfg.title}</span></div>`;
            innerHTML += `<div class="carousel-viewport" data-id="${cfg.id}">`;

            if (cfg.type === 'selector' || cfg.type === 'decision') {
                const opts = cfg.options;
                opts.forEach((opt, i) => {
                    const prevText = i > 0 ? `&larr; PREV` : '';
                    const nextText = i < opts.length - 1 ? `NEXT &rarr;` : '';
                    
                    innerHTML += `
                        <div class="sub-slide ${i===0 ? 'opt-active' : 'opt-hidden'}" data-opt-idx="${i}" data-val="${opt.id}">
                            ${opt.tags ? `<div class="role-label">${opt.tags[0].toUpperCase()}</div>` : ''}
                            <h1>${opt.label}</h1>
                            <div class="primary-question">${opt.sub}</div>
                            <div class="nav-hint">
                                <span style="flex:1; text-align:left;">${prevText}</span>
                                <span style="flex:2; text-align:center; color:#fff; font-weight:bold;">&darr; PULL TO SELECT &darr;</span>
                                <span style="flex:1; text-align:right;">${nextText}</span>
                            </div>
                        </div>
                    `;
                });
            }

            else if (cfg.type === 'llm_summary') {
                cfg.cards.forEach((card, i) => {
                    // Simplified for demo: Just showing first card as active
                    if(i===0) {
                        innerHTML += `
                        <div class="sub-slide static">
                            <div class="role-label">AI RECOMMENDATION</div>
                            <h1>${card.label}</h1>
                            <div class="content-text">${card.sub}</div>
                            <small style="color:#666; margin-top:20px;">(Simulated Logic)</small>
                        </div>`;
                    }
                });
            }

            else if (cfg.type === 'status') {
                innerHTML += `
                    <div class="sub-slide static">
                        <div class="status-box">
                            <span class="status-val">${cfg.display}</span>
                            <div class="content-text">Zomato • Swiggy • Blinkit • Local</div>
                        </div>
                    </div>`;
            }

            else if (cfg.type === 'final') {
                let btns = '';
                cfg.actions.forEach(act => {
                    let onclick = '';
                    if(act.action === 'whatsapp') onclick = `window.open('https://wa.me/916351537770', '_blank')`;
                    if(act.action === 'b2b') onclick = `window.open('https://wa.me/916351537770?text=BuildThis', '_blank')`;
                    
                    btns += `<button class="btn ${act.action==='whatsapp'?'btn-wa':''}" onclick="${onclick}">
                        ${act.label}<br><span style="font-size:0.7rem;opacity:0.7">${act.sub}</span>
                    </button>`;
                });

                innerHTML += `
                    <div class="sub-slide static">
                        <div class="final-actions" style="margin-top:auto; padding-bottom:40px;">
                            ${btns}
                        </div>
                    </div>`;
            }

            innerHTML += `</div>`;
            section.innerHTML = innerHTML;
            container.appendChild(section);
        });

        slideElements = Array.from(document.querySelectorAll('.main-slide'));
        attachEvents();
    }

    /* =========================================
       TOUCH & NAV ENGINE
       ========================================= */
    function showToast(msg) {
        const t = document.getElementById('toast');
        t.innerText = msg;
        t.classList.add('visible');
        setTimeout(() => t.classList.remove('visible'), 2000);
    }

    function goToSlide(idx) {
        if (idx < 0 || idx >= slideElements.length) return;
        
        const curr = slideElements[currentIdx];
        curr.classList.remove('active');
        
        if (idx > currentIdx) { curr.classList.add('prev'); curr.classList.remove('next'); } 
        else { curr.classList.add('next'); curr.classList.remove('prev'); }

        currentIdx = idx;
        const next = slideElements[currentIdx];
        next.classList.remove('prev', 'next');
        next.classList.add('active');
        
        dragRatio = 0;
        document.getElementById('depth-fill').style.height = '0%';
    }

    function attachEvents() {
        let startX = 0, startY = 0;

        document.querySelectorAll('.carousel-viewport').forEach(view => {
            const slides = Array.from(view.querySelectorAll('.sub-slide'));
            view._currOpt = 0;
            
            let isDragging = false;
            let axis = null;

            view.addEventListener('touchstart', e => {
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
                isDragging = true;
                axis = null;
            }, {passive: true});

            view.addEventListener('touchmove', e => {
                if(!isDragging) return;
                const dx = e.touches[0].clientX - startX;
                const dy = e.touches[0].clientY - startY;

                if(!axis) axis = Math.abs(dx) > Math.abs(dy) ? 'x' : 'y';

                const parentSlide = view.closest('.main-slide');
                const mode = parentSlide.dataset.mode;

                // OPTIONS MODE: Horizontal Swipe
                if(mode === 'options') {
                    if(axis === 'x') slides.forEach(s => s.style.transform = `translateX(${dx}px)`);
                    
                    // Pull to Select
                    if(axis === 'y' && dy > 0) {
                        e.preventDefault();
                        const r = Math.min(dy/MAX_DRAG, 1);
                        document.getElementById('depth-fill').style.height = (r*100)+'%';
                    }
                    return;
                }
            }, {passive: false});

            view.addEventListener('touchend', e => {
                if(!isDragging) return;
                isDragging = false;
                
                const dx = e.changedTouches[0].clientX - startX;
                const dy = e.changedTouches[0].clientY - startY;
                const parentSlide = view.closest('.main-slide');
                const mode = parentSlide.dataset.mode;

                // Navigation: Back (Swipe Up)
                if (axis === 'y' && dy < -50) {
                    if(currentIdx > 0) goToSlide(currentIdx - 1);
                    return;
                }

                // Options Logic
                if(mode === 'options') {
                    const total = slides.length;
                    let curr = view._currOpt;

                    // Horizontal Change
                    if(axis === 'x' && Math.abs(dx) > 50) {
                        if(dx < 0 && curr < total - 1) curr++; 
                        else if(dx > 0 && curr > 0) curr--;   
                        
                        view._currOpt = curr;
                        slides.forEach((s, i) => {
                            s.style.transform = '';
                            if(i === curr) { s.classList.remove('opt-hidden'); s.classList.add('opt-active'); }
                            else { s.classList.remove('opt-active'); s.classList.add('opt-hidden'); }
                        });
                    } else {
                        slides.forEach(s => s.style.transform = '');
                    }

                    // Vertical Select
                    if(axis === 'y' && dy > 60) {
                        const val = slides[curr].dataset.val;
                        USER_DATA[parentSlide.id] = val;
                        showToast(`SELECTED: ${val}`);
                        goToSlide(currentIdx + 1);
                    }
                    document.getElementById('depth-fill').style.height = '0%';
                    return;
                }

                // Static/Status Slides: Just Next
                if(axis === 'y' && dy > 50) {
                    goToSlide(currentIdx + 1);
                }
            });
        });
    }

    init(); // BOOT

</script>
</body>
</html>
